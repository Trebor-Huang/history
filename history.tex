\documentclass[UTF8]{ctexbook}
\usepackage[T1]{fontenc}
\usepackage[a4paper]{geometry}
\usepackage{graphicx}
\usepackage[dvipsnames]{xcolor}
\usepackage{amssymb,amsmath,amsthm}
\usepackage{fancyhdr}
\usepackage{biblatex}
\usepackage{mathrsfs}
\usepackage{quiver}
\usepackage{hyperref}
\usepackage{fontspec}

% Load computer modern font for e.g. cyrillic.
% Referring by file name is needed
% to get compatibility on my laptop and GitHub CI.
\newfontfamily\tempfont[
  BoldFont={cmunbx.otf},
  ItalicFont={cmunti.otf},
  BoldItalicFont={cmunbi.otf},
  Ligatures=TeX
]{cmunrm.otf}

% mathrsfs only supports a set of fixed sizes.
% Fixed by declaring myself.
\DeclareFontFamily{U}{rsfs}{\skewchar\font127 }
\DeclareFontShape{U}{rsfs}{m}{n}{%
   <-6.5> rsfs5
   <6.5-8.5> rsfs7
   <8.5-> rsfs10
}{}

% Defining some colors for hyperref
\newcommand\myshade{85}
\colorlet{mylinkcolor}{violet}
\colorlet{mycitecolor}{orange}
\colorlet{myurlcolor}{Aquamarine}

\hypersetup{
  linkcolor  = mylinkcolor!\myshade!black,
  citecolor  = mycitecolor!\myshade!black,
  urlcolor   = myurlcolor!\myshade!black,
  colorlinks = true,
}

% Small set of macros
\newcommand{\cons}[1]{\textsf{#1}}
\newcommand{\slogan}[1]{\begin{center}%
  \fcolorbox{red!80!green}{red!10}{%
    \large\textbf{#1}%
  }%
\end{center}}

% Theorems and definitions
\theoremstyle{plain}
\newtheorem{lemma}{引理}[chapter]
\newtheorem{theorem}{定理}[chapter]
\newtheorem{corollary}{推论}[chapter]

\theoremstyle{definition}
\newtheorem{definition}{定义}[chapter]

\theoremstyle{remark}
\newtheorem*{remark}{注}

% Bib resource
\addbibresource{history.bib}

% Page style
\pagestyle{fancy}
\fancyhead[L]{\nouppercase{\kaishu\rightmark}}
\fancyhead[R]{\nouppercase{\kaishu\leftmark}}
\setlength{\headheight}{14pt}

% Hack to force marginpar always on the left.
% TODO do we need that?
% Berries!
\newcommand{\berry}[1]{\marginpar[%
  \hfill%
  {\includegraphics[width=1cm]{images/difficulty#1.png}}%
  % Latex misparses nested optional arguments.
  % Hence we need extra braces to ensure they are grouped correctly.
  % I was so heroic when I realized that within 1 minute
  % without consulting any online sources.
]{%
  \includegraphics[width=1cm]{images/difficulty#1.png}%
  \hfill%
}}

\begin{document}
\setcounter{tocdepth}{1}
\tableofcontents
% TODO add the title page
\include{chapters/introduction.tex}
\include{chapters/beginnings.tex}
\include{chapters/curry-howard.tex}
\include{chapters/martin-lof.tex}
\include{chapters/category.tex}
\include{chapters/hott.tex}
\include{chapters/prospect.tex}

\emergencystretch 2em
\printbibliography[title=参考文献]
\end{document}
